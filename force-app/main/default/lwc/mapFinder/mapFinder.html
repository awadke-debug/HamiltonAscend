<template>
  <div class="main-container slds-is-relative">
    <div class="search-container">
      <div style="align-self: start;">
        <lightning-input type="text" label="ADDRESS OR ZIP" class="address-zip" value={addressText} onchange={handleAddressChange}></lightning-input>
      </div>
      <div style="align-self: start;">
        <lightning-combobox name="radius" label="RADIUS" options={radius} value={selectedRadius}
          onchange={handleRadiusChange} placeholder="Select Radius" class="radius-select"></lightning-combobox>
      </div>
      
    </div>

    <div style="display: flex; padding-top: 1rem; padding-bottom: 1 rem;">
      
      <lightning-button-stateful label-when-off="Advance Search" label-when-on="Hide Advance Search"
        style="margin-left: auto;" selected={showAdvanceFilter} onclick={handleToggleFilter}
        disabled={advanceFilterdisabled} class="slds-var-m-bottom_small" variant="text"></lightning-button-stateful>

        <template lwc:if={showAdvanceFilter}>
          <lightning-button-menu 
            alternative-text="Show menu"
            icon-name="utility:settings"
            icon-size="medium"
            variant="border-filled"
            menu-alignment="auto"
            class="slds-var-m-left_small"
            onselect={handleOnFilterMenu}
          >
            <lightning-menu-item value="load" label="Load Saved Filter"></lightning-menu-item>
            <lightning-menu-item value="save" label="Save Filter"></lightning-menu-item>
            <lightning-menu-item value="delete" label="Delete Saved Filter"></lightning-menu-item>
            <lightning-menu-item value="clear" label="Clear Advance Filter"></lightning-menu-item>
          </lightning-button-menu>
        </template>
    </div>

    <template lwc:if={showAdvanceFilter}>
      <div
        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 1rem; margin-bottom: 1rem;">

        <template for:each={advanceSearchFilters} for:item="fld">
          <template lwc:if={fld.isMultiRow}>
            <div key={fld.key} style={fld.style}>
              <c-map-filter-item field={fld} map-instance={mapInstance}></c-map-filter-item>
            </div>
          </template>
        </template>

        <template for:each={advanceSearchFilters} for:item="fld">
          <template if:false={fld.isMultiRow}>
            <div key={fld.key}>
              <c-map-filter-item field={fld} map-instance={mapInstance}></c-map-filter-item>
            </div>
          </template>
        </template>
      </div>
    </template>

    <div style="display: flex;" class="slds-var-m-bottom_xx-large">
      <div style="margin-right: auto; flex: 1; display:flex;">

        <lightning-button-stateful
          label-when-off="Show Map"
          label-when-on="Hide Map"
          label-when-hover="Toggle Map"
          icon-name-when-off="utility:expand"
          icon-name-when-on="utility:hide"
          variant="neutral"
          selected={showMap}
          onclick={handleToggleMap}
        ></lightning-button-stateful>
    
        <lightning-button-stateful
            label-when-off="Show pins"
            label-when-on="Hide pins"
            icon-name-when-off="utility:checkin"
            icon-name-when-on="utility:hide"
            selected={showPins}
            onclick={handleTogglePin}
            variant="neutral"
            class="slds-var-m-left_small slds-var-m-right_small"
            disabled={disableShowPinsBtn}
        ></lightning-button-stateful>
        <lightning-helptext content="Toggle to show/hide pins."></lightning-helptext>
        
        <!-- <template if:true={showMap}>
          <lightning-slider 
            label="Zoom" 
            max="22"
            min="1"
            size="small"
            step="1"
            type="horizontal"
            value={zoomLevel}
            onchange={handleZoomChange}
            variant="label-hidden"
          ></lightning-slider> 
        </template>-->
      </div>
      <template if:false={showTable}>
        <div style="margin-left: auto;">
          <c-map-finder-constituent-table onsearch={showSpinner}
            onrowselect={handleRowSelect} table-columns={tableColumns}
            onschedulemeeting={handleScheduleMeeting} 
            onclickexport={handleShowExportResults} 
            onclickaddtocampaign={handleShowAddToCampaign}
            onpagechange={handlePageChange}
            map-instance={mapInstance}
            show-table={showTable}>
          </c-map-finder-constituent-table>
        </div>
      </template>
      <div style="margin-left: auto;" class="slds-var-p-left_medium">
        <lightning-button class="search-btn slds-var-m-right_small" label="Search" onclick={handleSearch} variant="brand" icon-name="utility:search"></lightning-button>
        <lightning-button label="Clear" onclick={handleClearSearch} icon-name="utility:refresh" variant="brand-outline"></lightning-button>
      </div>
    </div>
    <template if:true={showMap}>
      <template lwc:if={zoomLevel}>
        <lightning-map map-markers={mapMarkers} onmarkerselect={handleMarkerSelect}
          selected-marker-value={selectedMarkerValue} list-view={listView} zoom-level={zoomLevel} center={center}></lightning-map>
      </template>
      <template lwc:else>
        <lightning-map map-markers={mapMarkers} onmarkerselect={handleMarkerSelect}
          selected-marker-value={selectedMarkerValue} list-view={listView} center={center}></lightning-map>
      </template>
    </template>

    <template if:true={showTable}>

      <c-map-finder-constituent-table onsearch={showSpinner}
        onrowselect={handleRowSelect} table-columns={tableColumns}
        onschedulemeeting={handleScheduleMeeting} 
        onclickexport={handleShowExportResults} 
        onclickaddtocampaign={handleShowAddToCampaign}
        onpagechange={handlePageChange}
        map-instance={mapInstance}
        show-table={showTable}
        show-add-to-campaign-btn={_showAddToCampaignBtn}
        is-schedulable={_isSchedulable}
        contact-id-field={contactIdField}
        show-export-result-btn={_showExportResultBtn}
        oncheckrow={handleCheckRow}
        hide-page-nav={hidePageNav}
        onselectall={handleSelectAll}
      >
      </c-map-finder-constituent-table>
    </template>

      <template if:true={showCreateMeeting}>
        <div class="slds-modal slds-fade-in-open slds-backdrop slds-modal_medium">
          <div class="slds-modal__container">
            <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-border-filled" onclick={handleCloseMeetingModal}>
                <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close"></use>
                </svg>
                <span class="slds-assistive-text">Cancel and close</span>
            </button>
            <div class="slds-modal__content slds-p-around_medium slds-is-relative">
              <lightning-flow
                flow-api-name="Contact_Report_Create_New_Contact_Report_Gift_Officers"
                flow-input-variables={inputVariables}
                onstatuschange={handleStatusChange}
              ></lightning-flow>
            </div>
          </div>
        </div>
      </template>
    
      <template if:true={showExportResults}>
          <c-map-finder-export-results onexportresults={handleExportResults} onclose={handleCloseExportResults} selected={tableColumns} table-cmp={dataTblCmp} map-instance={mapInstance}></c-map-finder-export-results>  
      </template>

      <template if:true={showAddToCampaign}>
        <c-map-finder-add-to-campaign onaddtocampaign={handleAddToCampaign} onclose={handleCloseAddToCampaign} table-cmp={dataTblCmp}></c-map-finder-add-to-campaign>
      </template>
    
      <template lwc:if={displaySpinner}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
      </template>
      <template lwc:elseif={advanceFiltersLoading}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>

      </template>
      <template lwc:elseif={markerDescPropsLoading}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        
      </template>
      <template lwc:elseif={markerPropertiesLoading}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        
      </template>
      <template lwc:elseif={dataTablePropertiesLoading}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
      </template>
    
  </div>

</template>